(()=>{"use strict";const e="http://localhost:3001",t=t=>fetch(e+t).then((e=>{if(!e.ok)throw new Error;return e.json()})),n=(t,n)=>fetch(e+t,{method:"POST",body:JSON.stringify(n),headers:{"Content-Type":"application/json"}}).then((e=>{if(!e.ok)throw new Error;return e.json()})),a=t=>fetch(e+t,{method:"DELETE"}).then((e=>{if(!e.ok)throw new Error;return e.json()}));(()=>{const e=document.getElementById("category-name"),d=document.getElementById("category-image"),o=document.getElementById("category-add-btn"),r=document.getElementById("category-container"),c=document.getElementById("product-category"),i={name:"",preview:""},u=()=>{""===e.value||""===d.value?o.disabled=!0:o.disabled=!1},l=()=>{t("/categories").then((e=>{(e=>{r.textContent="",e.forEach(((e,t)=>{r.insertAdjacentHTML("beforeend",`\n        <tr>\n          <th scope="row">${t+1}</th>\n          <td>${e.name}</td>\n          <td class="text-end">\n            <button type="button" class="btn btn-outline-danger btn-sm" data-category="${e.id}">\n              удалить\n            </button>\n          </td>\n        </tr>\n      `),c.insertAdjacentHTML("beforeend",`\n        <option value="${e.id}">${e.name}</option>\n      `)}))})(e)}))};e.addEventListener("input",(()=>{i.name=e.value,u()})),d.addEventListener("input",(()=>{const e=d.files[0];if("image/png"===e.type||"image/jpg"===e.type||"image/jpeg"===e.type){const t=new FileReader;t.onload=()=>{i.preview=t.result},t.onerror=()=>{i.preview="",d.value=""},t.readAsDataURL(e)}else d.value="";u()})),o.addEventListener("click",(t=>{n("/categories",{method:"POST",body:JSON.stringify(i),headers:{"Content-Type":"application/json"}}).then((()=>{e.value="",d.value="",l()}))})),r.addEventListener("click",(({target:e})=>{if("BUTTON"===e.tagName){const t=e.dataset.category;a(`/categories/${t}`).then((e=>{l()}))}})),l(),u()})(),(()=>{const e=document.getElementById("product-title"),d=document.getElementById("product-name"),o=document.getElementById("product-price"),r=document.getElementById("product-image"),c=document.getElementById("product-add-btn"),i=document.getElementById("product-table"),u=document.getElementById("product-category"),l={title:"",name:"",price:0,preview:"",category:0},s=e=>{i.textContent="",e.forEach(((e,t)=>{i.insertAdjacentHTML("beforeend",`\n        <tr>\n          <th scope="row">${t+1}</th>\n          <td>${e.title}</td>\n          <td>${e.name}</td>\n          <td>${e.price} ₽</td>\n          <td class="text-end">\n            <button type="button" class="btn btn-outline-danger btn-sm" data-product="${e.id}">удалить</button>\n          </td>\n        </tr>\n      `)}))},p=()=>{""===e.value||""===d.value||0===Number(o.value)||""===r.value||"default"===u.value?c.disabled=!0:c.disabled=!1},g=()=>{t("/products").then((e=>{s(e)}))};u.addEventListener("change",(e=>{l.category=u.value;const n="default"!==u.value?`/products?category=${u.value}`:"/products";t(n).then((e=>{s(e)})),p()})),d.addEventListener("input",(()=>{l.name=d.value,p()})),e.addEventListener("input",(()=>{l.title=e.value,p()})),o.addEventListener("input",(()=>{l.price=Number(o.value),p()})),r.addEventListener("input",(()=>{const e=r.files[0];if("image/png"===e.type||"image/jpg"===e.type||"image/jpeg"===e.type){const t=new FileReader;t.onload=()=>{l.preview=t.result},t.onerror=()=>{l.preview="",r.value=""},t.readAsDataURL(e)}else r.value="";p()})),c.addEventListener("click",(t=>{console.log("productData",l),n("/products",l).then((()=>{d.value="",r.value="",e.value="",o.value="",g()}))})),i.addEventListener("click",(({target:e})=>{if("BUTTON"===e.tagName){const t=e.dataset.product;a(`/products/${t}`).then((e=>{g()}))}})),g(),p()})()})();